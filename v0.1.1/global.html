<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>m3api: Global</title>

    <script defer src="scripts/prettify/prettify.js"></script>
    <script defer src="scripts/prettify/lang-css.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="version-warning.css">
</head>

<body>

<div id="main">

    <!-- VERSION-WARNING -->

    <h1 class="page-title">Global</h1>

    




<section>

<header>
    
        <h2></h2>
        
    
</header>

<article>
    <div class="container-overview">
    
        

        


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>


        
    
    </div>

    

    

    

    

    

    

    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    
    <h4 class="name" id="completeOAuthSession"><span class="type-signature">(async) </span>completeOAuthSession<span class="signature">(session, callbackUrl, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Handle an authorization callback from the user,
and complete an OAuth session.</p>
<p>Call this method when the user returns from the <a href="global.html#initOAuthSession">initOAuthSession</a> result,
with the full URL they were redirected to.
The m3api session will be set up for authenticated requests
(becoming an OAuth session).</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>session</code></td>
            

            <td class="type">
            
                
<span class="param-type">Session</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>The m3api session to which the authorization will apply.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>callbackUrl</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>The URL the user was redirected to.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="global.html#Options">Options</a></span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Request options.
The 'm3api-oauth2/client' option must be specified
either here or in the session’s default options.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.js.html">index.js</a>, <a href="index.js.html#line257">line 257</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="deserializeOAuthSession"><span class="type-signature"></span>deserializeOAuthSession<span class="signature">(session, serialization, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Deserialize OAuth components into the given m3api session,
turning it into an OAuth session equivalent to the one the serialization came from.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>session</code></td>
            

            <td class="type">
            
                
<span class="param-type">Session</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>The m3api session that the serialization should be applied to.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>serialization</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object.&lt;string, string></span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>A serialization that was
returned by <a href="global.html#serializeOAuthSession">serializeOAuthSession</a> (and possibly JSON-serialized in between).</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="global.html#Options">Options</a></span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>The 'm3api-oauth2/assert' option
has the same meaning here as in <a href="global.html#completeOAuthSession">completeOAuthSession</a>;
if you customize the options, it’s recommended to pass the same options to both functions.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.js.html">index.js</a>, <a href="index.js.html#line402">line 402</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="initOAuthSession"><span class="type-signature">(async) </span>initOAuthSession<span class="signature">(session, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {string}</span></h4>
    

    



<div class="description">
    <p>Initialize an OAuth session,
and generate the URL to authorize a user.</p>
<p>You should send the user to this URL,
then later call <a href="global.html#completeOAuthSession">completeOAuthSession</a> once they’ve been redirected back to you.</p>
<p>This function needs to be async for technical reasons,
but should resolve basically immediately
(no server communication is involved).</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>session</code></td>
            

            <td class="type">
            
                
<span class="param-type">Session</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>The m3api session with which the authorization will be associated.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="global.html#Options">Options</a></span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Request options.
The 'm3api-oauth2/client' option must be specified
either here or in the session’s default options.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.js.html">index.js</a>, <a href="index.js.html#line146">line 146</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        


<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">string</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="refreshOAuthSession"><span class="type-signature">(async) </span>refreshOAuthSession<span class="signature">(session, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Refresh the OAuth session, getting a new access token.</p>
<p>Access tokens generated by MediaWiki are short-lived (4 hours),
so they need to be refreshed periodically.
A future version will hopefully arrange for this to be done automatically.
Until then, if you need the session to be alive for longer,
you will need to call this manually from time to time.
(Calling it too often shouldn’t cause any ill effects,
except for the delay introduced by the additional requests.)</p>
<p>Note that refreshing the access token currently requires the client secret,
see <a href="https://phabricator.wikimedia.org/T323855">T323855</a>.
(That is, non-confidential clients <em>can</em> use this function,
but only if they use their client secret.)</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>session</code></td>
            

            <td class="type">
            
                
<span class="param-type">Session</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>The OAuth session whose access token should be refreshed.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="global.html#Options">Options</a></span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Request options.
The 'm3api-oauth2/client' option must be specified
either here or in the session’s default options.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.js.html">index.js</a>, <a href="index.js.html#line318">line 318</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="serializeOAuthSession"><span class="type-signature"></span>serializeOAuthSession<span class="signature">(session, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {Object.&lt;string, string>}</span></h4>
    

    



<div class="description">
    <p>Serialize the OAuth components of the given OAuth session,
so they can be stored in the user session (in some kind of session store).</p>
<p>You should NOT let the user directly access the serialization
(e.g. by storing it in a cookie) –
that would let them impersonate your application
by making requests directly that appear to come from your app.</p>
<p>The serialization is an opaque value,
JSON-serializable but otherwise only suitable
for passing it into <a href="global.html#deserializeOAuthSession">deserializeOAuthSession</a>.
Don’t do anything else with it.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>session</code></td>
            

            <td class="type">
            
                
<span class="param-type">Session</span>


            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>The OAuth session whose OAuth components should be serialized.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="global.html#Options">Options</a></span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>Included for consistency with the other functions;
currently does nothing.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.js.html">index.js</a>, <a href="index.js.html#line377">line 377</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>A JSON-serializable object
with unspecified structure.
Passing a copy of this object into <a href="global.html#deserializeOAuthSession">deserializeOAuthSession</a>
will turn another m3api session into an OAuth session equivalent to this one.</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Object.&lt;string, string></span>


    </dd>
</dl>

    





        
    

    
        <h3 class="subsection-title">Type Definitions</h3>

        
                
<h4 class="name" id="Options">Options</h4>




<div class="description">
    <p>Request options understood by this package.
All other options will be passed through to m3api.</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Object</span>


        </li>
    </ul>





    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>'m3api-oauth2/client'</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="OAuthClient.html">OAuthClient</a></span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            

            <td class="description last"><p>The OAuth client, encapsulating the credentials.
This option must be specified, there is no possible default value.
(It’s recommended to set it in the session’s default options.)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>'m3api-oauth2/assert'</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            

            <td class="description last"><p>Whether to set the 'assert' parameter in the session’s defaultParams to 'user'.
Defaults to true.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>'m3api-oauth2/requireCrypto'</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            

            <td class="description last"><p>Whether to require the Web Crypto API to generate and hash the PKCE code verifier.
If false, and the Web Crypto API is not available,
m3api-oauth2 will fall back to Math.random() (non-cryptographically secure pseudo-random numbers)
to generate the code verifier, and will send it unhashed;
this allows using m3api-oauth2 on Node 12.
If true, m3api-oauth2 will instead throw a <a href="NoWebCryptoApiError.html">NoWebCryptoApiError</a>
if the Web Crypto API is unavailable.
Defaults to false.</p></td>
        </tr>

    
    </tbody>
</table>




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="index.js.html">index.js</a>, <a href="index.js.html#line60">line 60</a>
    </li></ul></dd>
    

    

    

    
</dl>






            
    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="NoWebCryptoApiError.html">NoWebCryptoApiError</a></li><li><a href="OAuthClient.html">OAuthClient</a></li></ul><h3>Global</h3><ul><li><a href="global.html#completeOAuthSession">completeOAuthSession</a></li><li><a href="global.html#deserializeOAuthSession">deserializeOAuthSession</a></li><li><a href="global.html#initOAuthSession">initOAuthSession</a></li><li><a href="global.html#refreshOAuthSession">refreshOAuthSession</a></li><li><a href="global.html#serializeOAuthSession">serializeOAuthSession</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a>
</footer>

<script>document.addEventListener('DOMContentLoaded', function () { prettyPrint(); });</script>
<script async src="scripts/linenumber.js"></script>
</body>
</html>